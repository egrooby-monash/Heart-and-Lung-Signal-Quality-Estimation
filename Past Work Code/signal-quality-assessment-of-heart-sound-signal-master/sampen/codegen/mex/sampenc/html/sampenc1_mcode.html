<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">e</span>,<span class="var type1" id="S3T2U4">A</span>,<span class="var type1" id="S4T2U5">B</span>]=<span class="message warning" id="M1F1C">sampenc</span>(<span class="var type1" id="S5T1U8">y</span>,<span class="var type1" id="S6T3U9">M</span>,<span class="var type1" id="S7T3U10">r</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%function [e,A,B]=sampenc(y,M,r);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%Input</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%y input data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%M maximum template length</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%r matching tolerance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">%Output</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">%e sample entropy estimates for m=0,1,<span class="keyword">...</span><span class="comment">,M-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">%A number of matches for m=1,<span class="keyword">...</span><span class="comment">,M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">%B number of matches for m=0,<span class="keyword">...</span><span class="comment">,M-1 excluding last point</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T3:U7"><span class="var type1" id="S8T3U13">n</span>=<span class="mxinfo" id="T3:U9">length(<span class="var type1" id="S5T1U16">y</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T4:U11"><span class="var type1" id="S10T4U19">lastrun</span>=<span class="mxinfo" id="T4:U13">zeros(<span class="mxinfo" id="T3:U14">1</span>,<span class="var type1" id="S8T3U23">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo" id="T4:U16"><span class="var type1" id="S12T4U26">run</span>=<span class="mxinfo" id="T4:U18">zeros(<span class="mxinfo" id="T3:U19">1</span>,<span class="var type1" id="S8T3U30">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo" id="T2:U21"><span class="var type1" id="S3T2U33">A</span>=<span class="mxinfo" id="T2:U23">zeros(<span class="var type1" id="S6T3U36">M</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T2:U25"><span class="var type1" id="S4T2U40">B</span>=<span class="mxinfo" id="T2:U27">zeros(<span class="var type1" id="S6T3U43">M</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T2:U29"><span class="var type1" id="S13T2U47">p</span>=<span class="mxinfo" id="T2:U31">zeros(<span class="var type1" id="S6T3U50">M</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S2T2U54">e</span>=<span class="mxinfo" id="T2:U35">zeros(<span class="var type1" id="S6T3U57">M</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S14T3U61">i</span>=<span class="mxinfo" id="T3:U38">1</span>:(<span class="mxinfo" id="T3:U39"><span class="var type1" id="S8T3U66">n</span>-<span class="mxinfo" id="T3:U41">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">   <span class="mxinfo" id="T3:U42"><span class="var type1" id="S15T3U70">nj</span>=<span class="mxinfo" id="T3:U44"><span class="var type1" id="S8T3U72">n</span>-<span class="var type1" id="S14T3U73">i</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">   <span class="mxinfo" id="T3:U47"><span class="var type1" id="S16T3U76">y1</span>=<span class="mxinfo" id="T3:U49"><span class="var type1" id="S5T1U78">y</span>(<span class="var type1" id="S14T3U79">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S17T3U82">jj</span>=<span class="mxinfo" id="T3:U53">1</span>:<span class="var type1" id="S15T3U85">nj</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">      <span class="mxinfo" id="T3:U55"><span class="var type1" id="S18T3U88">j</span>=<span class="mxinfo" id="T3:U57"><span class="var type1" id="S17T3U90">jj</span>+<span class="var type1" id="S14T3U91">i</span></span></span>;      </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T8:U60"><span class="mxinfo" id="T3:U61">abs(<span class="mxinfo" id="T3:U62"><span class="mxinfo" id="T3:U63"><span class="var type1" id="S5T1U99">y</span>(<span class="var type1" id="S18T3U100">j</span>)</span>-<span class="var type1" id="S16T3U101">y1</span></span>)</span>&lt;<span class="var type1" id="S7T3U102">r</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">         <span class="mxinfo" id="T3:U68"><span class="mxinfo" id="T3:U69"><span class="var type1" id="S12T4U106">run</span>(<span class="var type1" id="S17T3U107">jj</span>)</span>=<span class="mxinfo" id="T3:U72"><span class="mxinfo" id="T3:U73"><span class="var type1" id="S10T4U110">lastrun</span>(<span class="var type1" id="S17T3U111">jj</span>)</span>+<span class="mxinfo" id="T3:U76">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">         <span class="mxinfo" id="T3:U77"><span class="var type1" id="S20T3U115">M1</span>=<span class="mxinfo" id="T3:U79">min(<span class="var type1" id="S6T3U118">M</span>,<span class="mxinfo" id="T3:U81"><span class="var type1" id="S12T4U120">run</span>(<span class="var type1" id="S17T3U121">jj</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">         <span class="keyword">for</span> <span class="var type1" id="S22T3U124">m</span>=<span class="mxinfo" id="T3:U85">1</span>:<span class="var type1" id="S20T3U127">M1</span>           </span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">            <span class="mxinfo" id="T3:U87"><span class="mxinfo" id="T3:U88"><span class="var type1" id="S3T2U131">A</span>(<span class="var type1" id="S22T3U132">m</span>)</span>=<span class="mxinfo" id="T3:U91"><span class="mxinfo" id="T3:U92"><span class="var type1" id="S3T2U135">A</span>(<span class="var type1" id="S22T3U136">m</span>)</span>+<span class="mxinfo" id="T3:U95">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T8:U96"><span class="var type1" id="S18T3U141">j</span>&lt;<span class="var type1" id="S8T3U142">n</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">               <span class="mxinfo" id="T3:U99"><span class="mxinfo" id="T3:U100"><span class="var type1" id="S4T2U146">B</span>(<span class="var type1" id="S22T3U147">m</span>)</span>=<span class="mxinfo" id="T3:U103"><span class="mxinfo" id="T3:U104"><span class="var type1" id="S4T2U150">B</span>(<span class="var type1" id="S22T3U151">m</span>)</span>+<span class="mxinfo" id="T3:U107">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">            <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">      <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">         <span class="mxinfo" id="T3:U108"><span class="mxinfo" id="T3:U109"><span class="var type1" id="S12T4U157">run</span>(<span class="var type1" id="S17T3U158">jj</span>)</span>=<span class="mxinfo" id="T3:U112">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">      <span class="keyword">end</span>      </span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S18T3U162">j</span>=<span class="mxinfo" id="T3:U114">1</span>:<span class="var type1" id="S15T3U165">nj</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">      <span class="mxinfo" id="T3:U116"><span class="mxinfo" id="T3:U117"><span class="var type1" id="S10T4U169">lastrun</span>(<span class="var type1" id="S18T3U170">j</span>)</span>=<span class="mxinfo" id="T3:U120"><span class="var type1" id="S12T4U172">run</span>(<span class="var type1" id="S18T3U173">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo" id="T3:U123"><span class="var type1" id="S23T3U176">N</span>=<span class="mxinfo" id="T3:U125"><span class="mxinfo" id="T3:U126"><span class="var type1" id="S8T3U179">n</span>*(<span class="mxinfo" id="T3:U128"><span class="var type1" id="S8T3U182">n</span>-<span class="mxinfo" id="T3:U130">1</span></span>)</span>/<span class="mxinfo" id="T3:U131">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo" id="T2:U132"><span class="var type1" id="S4T2U187">B</span>=<span class="mxinfo" id="T2:U134">[<span class="var type1" id="S23T3U190">N</span>;<span class="mxinfo" id="T2:U136"><span class="var type1" id="S4T2U193">B</span>(<span class="mxinfo" id="T3:U138">1</span>:(<span class="mxinfo" id="T3:U139"><span class="var type1" id="S6T3U198">M</span>-<span class="mxinfo" id="T3:U141">1</span></span>))</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo" id="T2:U142"><span class="var type1" id="S13T2U202">p</span>=<span class="mxinfo" id="T2:U144"><span class="var type1" id="S3T2U204">A</span>./<span class="var type1" id="S4T2U205">B</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo" id="T2:U147"><span class="var type1" id="S2T2U208">e</span>=<span class="mxinfo" id="T2:U149">-<span class="mxinfo" id="T2:U150">log(<span class="var type1" id="S13T2U212">p</span>)</span></span></span>;</span></span>
</pre>
